<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Journey - Sky Diver</title>
    <style>
        body { 
            margin: 0; overflow: hidden; 
            background: linear-gradient(0deg, #87ceeb 0%, #4169e1 30%, #191970 70%, #000000 100%);
            animation: altitudeBackground 15s infinite;
        }
        canvas { display: block; }
        .title { 
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%); 
            color: #ffffff; font-family: 'Impact', sans-serif; font-size: 42px; 
            letter-spacing: 4px; text-shadow: 3px 3px 8px rgba(0,0,0,0.8);
            text-transform: uppercase; animation: skyShimmer 3s infinite;
        }
        .dive-stage {
            position: absolute; top: 70px; left: 50%; transform: translateX(-50%);
            color: #ffd700; font-family: 'Arial Black', sans-serif; font-size: 20px; 
            font-weight: bold; letter-spacing: 3px; text-shadow: 2px 2px 6px rgba(0,0,0,0.9);
        }
        .altitude-display {
            position: absolute; bottom: 30px; right: 30px;
            color: #00ff00; font-family: 'Courier New', monospace; font-size: 16px;
            background: rgba(0,0,0,0.7); padding: 12px; border-radius: 8px;
            border: 2px solid #ffd700;
        }
        @keyframes altitudeBackground {
            0%, 100% { filter: brightness(1) contrast(1); }
            50% { filter: brightness(1.2) contrast(1.1); }
        }
        @keyframes skyShimmer {
            0%, 100% { text-shadow: 3px 3px 8px rgba(255,255,255,0.8); }
            50% { text-shadow: 6px 6px 16px rgba(255,255,255,0.4); }
        }
    </style>
</head>
<body>
    <div class="title">SKY DIVER</div>
    <div class="dive-stage" id="diveStage">AIRCRAFT PREPARATION</div>
    <div class="altitude-display" id="altitudeDisplay">
        Altitude: 15,000ft<br>
        Speed: 0 mph<br>
        Status: PREPARING
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="../particle-being-library.js"></script>
    <script>
        let scene, camera, renderer, particleSystem;
        let time = 0;
        let currentStage = 0;
        let stageTimer = 0;
        let windEffects = [];
        let clouds = [];
        let parachute = null;
        let aircraft = null;
        
        const diveStages = [
            'AIRCRAFT PREPARATION', 'DOOR OPENING', 'THE LEAP', 'FREE FALL CHAOS',
            'STABLE FALL', 'PARACHUTE DEPLOYMENT', 'GENTLE DESCENT'
        ];

        const stageData = [
            { altitude: '15,000ft', speed: '0 mph', status: 'PREPARING' },
            { altitude: '15,000ft', speed: '120 mph', status: 'READY TO JUMP' },
            { altitude: '14,800ft', speed: '0 mph', status: 'INITIAL FALL' },
            { altitude: '12,000ft', speed: '120 mph', status: 'FREE FALLING' },
            { altitude: '8,000ft', speed: '120 mph', status: 'CONTROLLED FALL' },
            { altitude: '5,000ft', speed: '15 mph', status: 'CHUTE DEPLOYED' },
            { altitude: '1,000ft', speed: '12 mph', status: 'LANDING APPROACH' }
        ];

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 20);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Create fearless sky diver particle system
            particleSystem = new ParticleBeingSystem(scene, {
                particleCount: 310,
                particleSize: 0.09,
                speedMultiplier: 3.2,
                colorRange: { h: 0.05, s: 0.7, lMin: 0.4, lMax: 0.8 }
            });

            createSkydiver();
            createSkyEnvironment();
            animate();
        }

        function createSkydiver() {
            const skydiver = particleSystem.convertToParticleBeing(
                null,
                { x: 0, y: 10, z: 0 },
                {
                    particleCount: 340,
                    states: ['nervous', 'preparing', 'falling', 'flying'],
                    stateTimings: { nervous: 4, preparing: 3, falling: 5, flying: 4 },
                    attractionForces: { nervous: 0.04, preparing: 0.03, falling: 0.01, flying: 0.02 }
                }
            );

            // 7 distinct skydiving stages with extreme psychological and physical differences
            const originalUpdate = particleSystem.updateBeing.bind(particleSystem);
            particleSystem.updateBeing = function(being, deltaTime) {
                originalUpdate(being, deltaTime);
                
                stageTimer += deltaTime;
                if (stageTimer > 6) {
                    currentStage = (currentStage + 1) % diveStages.length;
                    stageTimer = 0;
                    document.getElementById('diveStage').textContent = diveStages[currentStage];
                    const data = stageData[currentStage];
                    document.getElementById('altitudeDisplay').innerHTML = 
                        `Altitude: ${data.altitude}<br>Speed: ${data.speed}<br>Status: ${data.status}`;
                }
                
                switch(currentStage) {
                    case 0: // AIRCRAFT PREPARATION - Nervous, compact, checking gear
                        being.particles.forEach((particle, i) => {
                            particle.scale.setScalar(0.7); // Nervous tension
                            
                            // Nervous fidgeting
                            particle.userData.velocity.multiplyScalar(0.3); // Constrained movement
                            particle.position.x += Math.sin(time * 20 + i) * 0.001; // Nervous trembling
                            particle.position.y += Math.cos(time * 25 + i) * 0.0008;
                            
                            // Gear checking motions
                            if (i > 100 && i < 140) { // Arms
                                particle.userData.targetPosition.x += Math.sin(time * 8 + i * 0.1) * 0.5;
                                particle.userData.targetPosition.y += Math.cos(time * 6 + i * 0.1) * 0.3;
                            }
                            
                            // Sitting/crouched position
                            particle.userData.targetPosition.y *= 0.7;
                            
                            // Nervous pale color
                            particle.material.color.setHSL(0.1, 0.4, 0.7 + Math.sin(time * 15) * 0.1);
                            particle.material.opacity = 0.8 + Math.sin(time * 30 + i) * 0.2;
                        });
                        
                        being.userData.basePosition.set(0, 10, 0); // Inside aircraft
                        
                        // Interior aircraft view
                        camera.position.set(3, 11, 8);
                        camera.lookAt(0, 10, 0);
                        break;
                        
                    case 1: // DOOR OPENING - Anticipation, edge positioning, fear/excitement
                        being.particles.forEach((particle, i) => {
                            particle.scale.setScalar(0.8);
                            
                            // Moving toward door edge
                            particle.userData.velocity.z -= 0.005;
                            
                            // Wind buffeting from open door
                            particle.position.x += Math.sin(time * 30 + i) * 0.003;
                            particle.position.y += Math.cos(time * 35 + i) * 0.002;
                            
                            // Gripping/bracing motions
                            if (i > 120 && i < 160) { // Arms
                                particle.userData.targetPosition.x += Math.sin(time * 10) * 0.8;
                                particle.userData.targetPosition.z -= 0.5; // Holding door frame
                                particle.scale.setScalar(1.2); // Gripping tension
                            }
                            
                            // Looking down motion
                            if (i < 50) { // Head
                                particle.userData.targetPosition.y -= 0.3;
                                particle.userData.targetPosition.x += Math.sin(time * 5) * 0.2;
                            }
                            
                            // Fear/excitement mixed color
                            particle.material.color.setHSL(
                                0.08 + Math.sin(time * 12) * 0.05,
                                0.8,
                                0.6 + Math.abs(Math.sin(time * 20)) * 0.2
                            );
                        });
                        
                        being.userData.basePosition.z -= 0.02;
                        
                        // Edge of aircraft camera
                        camera.position.set(5, 10, 15);
                        camera.lookAt(being.userData.basePosition);
                        
                        // Create wind effects
                        if (Math.random() < 0.1) {
                            createWindEffect(being.userData.basePosition);
                        }
                        break;
                        
                    case 2: // THE LEAP - Momentary expansion, initial fall, shock
                        being.particles.forEach((particle, i) => {
                            // Initial shock expansion
                            const leapShock = 1 + Math.min(stageTimer * 0.5, 0.8);
                            particle.scale.setScalar(0.6 + leapShock * 0.4);
                            
                            // Initial fall acceleration
                            particle.userData.velocity.y -= 0.02 * stageTimer;
                            
                            // Arms/legs spreading in shock
                            if (i > 100 && i < 180) { // Limbs
                                particle.userData.targetPosition.x += Math.sign(particle.userData.targetPosition.x) * leapShock;
                                particle.userData.targetPosition.y += Math.abs(particle.userData.targetPosition.y) * leapShock * 0.5;
                            }
                            
                            // Shock/disbelief
                            particle.material.opacity = 0.7 + Math.sin(time * 50 + i) * 0.3;
                            particle.material.color.setHSL(0.05, 0.9, 0.8); // Bright shock color
                        });
                        
                        being.userData.basePosition.y -= stageTimer * stageTimer * 0.5; // Falling acceleration
                        
                        // Falling away camera
                        camera.position.set(0, being.userData.basePosition.y + 8, 12);
                        camera.lookAt(being.userData.basePosition);
                        break;
                        
                    case 3: // FREE FALL CHAOS - Tumbling, out of control, speed effects
                        being.particles.forEach((particle, i) => {
                            particle.scale.setScalar(1.1); // Wind resistance expansion
                            
                            // Chaotic tumbling motion
                            particle.userData.velocity.x += (Math.random() - 0.5) * 0.05;
                            particle.userData.velocity.y -= 0.08; // Fast falling
                            particle.userData.velocity.z += (Math.random() - 0.5) * 0.03;
                            
                            // Tumbling rotation effects
                            const tumble = time * 15;
                            const rotatedX = particle.userData.targetPosition.x * Math.cos(tumble) - particle.userData.targetPosition.z * Math.sin(tumble);
                            const rotatedZ = particle.userData.targetPosition.x * Math.sin(tumble) + particle.userData.targetPosition.z * Math.cos(tumble);
                            particle.userData.targetPosition.x = rotatedX;
                            particle.userData.targetPosition.z = rotatedZ;
                            
                            // Speed blur effect
                            particle.material.opacity = 0.5 + Math.random() * 0.5;
                            particle.scale.y = 2.0; // Vertical stretch from speed
                            particle.scale.x = 0.6;
                            particle.scale.z = 0.6;
                            
                            // Chaotic panic color
                            particle.material.color.setHSL(0.12, 0.9, 0.7 + Math.sin(time * 30 + i) * 0.3);
                        });
                        
                        // Rapid descent
                        being.userData.basePosition.y -= 0.5;
                        being.userData.basePosition.x += Math.sin(time * 8) * 0.3; // Tumbling sideways
                        
                        // Chaotic tumbling camera
                        camera.position.set(
                            being.userData.basePosition.x + Math.sin(time * 12) * 8,
                            being.userData.basePosition.y + 6 + Math.cos(time * 10) * 3,
                            being.userData.basePosition.z + 15 + Math.sin(time * 8) * 5
                        );
                        camera.lookAt(being.userData.basePosition);
                        
                        // Create speed/wind trails
                        if (Math.random() < 0.2) {
                            createSpeedTrail(being.userData.basePosition);
                        }
                        break;
                        
                    case 4: // STABLE FALL - Spread eagle, controlled, enjoying
                        being.particles.forEach((particle, i) => {
                            particle.scale.setScalar(1.0);
                            
                            // Stable spread eagle position
                            if (i > 100 && i < 150) { // Arms
                                particle.userData.targetPosition.x += Math.sign(particle.userData.targetPosition.x) * 2;
                                particle.userData.targetPosition.y += 0.5;
                            }
                            
                            if (i > 200) { // Legs
                                particle.userData.targetPosition.x += Math.sign(particle.userData.targetPosition.x) * 1.5;
                            }
                            
                            // Controlled falling motion
                            particle.userData.velocity.y -= 0.06;
                            
                            // Gentle adjustments for stability
                            particle.userData.velocity.x += Math.sin(time * 3 + i * 0.1) * 0.001;
                            particle.userData.velocity.z += Math.cos(time * 2 + i * 0.1) * 0.001;
                            
                            // Confident, exhilarated color
                            particle.material.color.setHSL(0.15, 0.7, 0.8);
                            particle.material.opacity = 0.9;
                            
                            // Enjoying the experience
                            if (i < 50) { // Head looking around
                                particle.userData.targetPosition.x += Math.sin(time * 2) * 0.3;
                            }
                        });
                        
                        being.userData.basePosition.y -= 0.3; // Steady controlled fall
                        
                        // Stable following camera
                        camera.position.set(8, being.userData.basePosition.y + 5, 20);
                        camera.lookAt(being.userData.basePosition);
                        break;
                        
                    case 5: // PARACHUTE DEPLOYMENT - Sudden expansion, deceleration, relief
                        being.particles.forEach((particle, i) => {
                            // Sudden jolt from parachute opening
                            if (stageTimer < 1) {
                                particle.userData.velocity.y += 0.1; // Upward jolt
                                particle.scale.setScalar(1.5); // Jolt expansion
                            } else {
                                particle.scale.setScalar(0.9); // Relief compression
                            }
                            
                            // Slowing down dramatically
                            particle.userData.velocity.multiplyScalar(0.8);
                            
                            // Arms/body adjusting to harness
                            if (i > 120 && i < 160) { // Arms
                                particle.userData.targetPosition.y += 1;
                                particle.userData.targetPosition.x *= 0.7; // Pulled in by harness
                            }
                            
                            // Relief and gratitude
                            particle.material.color.setHSL(0.3, 0.6, 0.8 + Math.sin(time * 4) * 0.1);
                            
                            // Slower descent
                            particle.userData.velocity.y -= 0.005;
                        });
                        
                        // Create parachute
                        if (!parachute && stageTimer > 0.5) {
                            createParachute(being.userData.basePosition);
                        }
                        
                        being.userData.basePosition.y -= 0.05; // Very slow descent
                        
                        // Parachute deployment camera
                        camera.position.set(-12, being.userData.basePosition.y + 15, 25);
                        camera.lookAt(being.userData.basePosition);
                        break;
                        
                    case 6: // GENTLE DESCENT - Peaceful floating, panoramic views
                        being.particles.forEach((particle, i) => {
                            particle.scale.setScalar(0.8); // Relaxed
                            
                            // Gentle swaying motion
                            particle.position.x += Math.sin(time * 1.5 + i * 0.05) * 0.002;
                            particle.position.z += Math.cos(time * 1.2 + i * 0.03) * 0.002;
                            
                            // Very slow descent
                            particle.userData.velocity.y -= 0.002;
                            particle.userData.velocity.multiplyScalar(0.95);
                            
                            // Peaceful observation pose
                            if (i > 120 && i < 160) { // Arms
                                particle.userData.targetPosition.x += Math.sin(time * 2) * 0.3;
                                particle.userData.targetPosition.y += 0.2;
                            }
                            
                            // Looking around at views
                            if (i < 50) { // Head
                                particle.userData.targetPosition.x += Math.sin(time * 1) * 0.4;
                                particle.userData.targetPosition.y += Math.cos(time * 0.8) * 0.2;
                            }
                            
                            // Peaceful, content color
                            particle.material.color.setHSL(0.58, 0.5, 0.7 + Math.sin(time * 2) * 0.1);
                            particle.material.opacity = 0.9;
                        });
                        
                        being.userData.basePosition.y -= 0.02; // Gentle landing approach
                        
                        // Panoramic descent camera
                        camera.position.set(
                            Math.sin(time * 0.3) * 30,
                            being.userData.basePosition.y + 20,
                            Math.cos(time * 0.3) * 30
                        );
                        camera.lookAt(being.userData.basePosition);
                        break;
                }
                
                updateSkyElements();
            };

            particleSystem.createAmbientParticles(80);
        }

        function createSkyEnvironment() {
            // Create aircraft
            aircraft = new THREE.Mesh(
                new THREE.BoxGeometry(3, 1, 8),
                new THREE.MeshBasicMaterial({
                    color: 0x666666,
                    transparent: true,
                    opacity: 0.7
                })
            );
            aircraft.position.set(0, 10, 5);
            scene.add(aircraft);

            // Create clouds
            for (let i = 0; i < 10; i++) {
                const cloud = new THREE.Mesh(
                    new THREE.SphereGeometry(3 + Math.random() * 2, 8, 8),
                    new THREE.MeshBasicMaterial({
                        color: 0xffffff,
                        transparent: true,
                        opacity: 0.3
                    })
                );
                cloud.position.set(
                    (Math.random() - 0.5) * 100,
                    Math.random() * 20 - 10,
                    (Math.random() - 0.5) * 100
                );
                scene.add(cloud);
                clouds.push(cloud);
            }
        }

        function createParachute(position) {
            parachute = new THREE.Mesh(
                new THREE.ConeGeometry(8, 4, 16),
                new THREE.MeshBasicMaterial({
                    color: 0xff6600,
                    transparent: true,
                    opacity: 0.6,
                    side: THREE.DoubleSide
                })
            );
            parachute.position.copy(position);
            parachute.position.y += 10;
            parachute.rotation.x = Math.PI;
            scene.add(parachute);
        }

        function createWindEffect(position) {
            const wind = new THREE.Mesh(
                new THREE.SphereGeometry(0.1, 4, 4),
                new THREE.MeshBasicMaterial({
                    color: 0xffffff,
                    transparent: true,
                    opacity: 0.6
                })
            );
            wind.position.copy(position);
            wind.userData = { 
                life: 0,
                velocity: new THREE.Vector3(
                    (Math.random() - 0.5) * 0.2,
                    (Math.random() - 0.5) * 0.1,
                    Math.random() * 0.3
                )
            };
            scene.add(wind);
            windEffects.push(wind);
        }

        function createSpeedTrail(position) {
            const trail = new THREE.Mesh(
                new THREE.SphereGeometry(0.05, 4, 4),
                new THREE.MeshBasicMaterial({
                    color: 0x00ffff,
                    transparent: true,
                    opacity: 0.8
                })
            );
            trail.position.copy(position);
            trail.userData = { 
                life: 0,
                velocity: new THREE.Vector3(0, 0.1, 0) // Trailing upward
            };
            scene.add(trail);
            windEffects.push(trail);
        }

        function updateSkyElements() {
            // Update parachute position
            if (parachute && particleSystem.beings[0]) {
                const diverPos = particleSystem.beings[0].userData.basePosition;
                parachute.position.x = diverPos.x;
                parachute.position.z = diverPos.z;
                parachute.position.y = diverPos.y + 8;
                
                // Parachute swaying
                parachute.rotation.z = Math.sin(time * 2) * 0.1;
                parachute.position.x += Math.sin(time * 1.5) * 0.5;
            }

            // Update wind effects
            windEffects = windEffects.filter(effect => {
                effect.userData.life += 0.016;
                effect.position.add(effect.userData.velocity);
                effect.userData.velocity.multiplyScalar(0.98);
                effect.material.opacity = Math.max(0, 0.6 - effect.userData.life * 0.3);
                
                if (effect.material.opacity <= 0) {
                    scene.remove(effect);
                    return false;
                }
                return true;
            });

            // Update clouds
            clouds.forEach(cloud => {
                cloud.position.x += 0.01;
                cloud.rotation.y += 0.001;
                if (cloud.position.x > 60) {
                    cloud.position.x = -60;
                }
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            time += 0.016;

            particleSystem.update(0.016);
            
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        init();
    </script>
</body>
</html>